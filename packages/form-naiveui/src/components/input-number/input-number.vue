<script setup lang="ts">
import { NInputNumber } from 'naive-ui'
import { useField } from 'vee-validate'
import { InputHTMLAttributes, useAttrs } from 'vue'

const props = defineProps<{
  id: string
  value?: string
  label: string
}>()

const attrs: InputHTMLAttributes = useAttrs()
const {
  value: inputValue,
  handleChange,
  handleBlur,
  errorMessage,
} = useField<string>(attrs.name as string, undefined, {
  initialValue: props.value,
  validateOnValueUpdate: false,
})
const validationListeners = {
  blur: handleBlur,
  change: handleChange,
  input: (e: boolean) => handleChange(e, !!errorMessage.value),
}
</script>

<script lang="ts">
export default {
  inheritAttrs: false,
}
</script>

<template>
  <label
    v-if="label"
    :for="$attrs.id as string"
    class="block text-sm font-medium text-gray-900 dark:text-gray-200"
  >{{ label }}
  </label>
  <div class="relative mt-1 rounded-md shadow-sm">
    <NInputNumber
      v-bind="$attrs"
      :status="errorMessage ? 'error' : 'success'"
      :value="inputValue"
      :aria-invalid="errorMessage ? true : false"

      size="medium"
      v-on="validationListeners"
    >
      <slot />
    </NInputNumber>
  </div>
  <p v-show="errorMessage" class="mt-2 text-sm text-red-600">
    {{ errorMessage }}
  </p>
</template>
